<% layout('layouts/layout') -%>

<h1>Approvals</h1>

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <!-- No create button for approvals, as they are created via booking -->
  </div>
  <form class="d-flex" role="search" action="/approvals" method="GET">
    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" name="filter" value="<%= filter %>">
    <button class="btn btn-outline-success" type="submit">Search</button>
  </form>
</div>

<table class="table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Booking Number</th>
      <th>Approver</th>
      <th>Level</th>
      <th>Status</th>
      <th>Approved At</th>
    </tr>
  </thead>
  <tbody>
    <% approvals.forEach(approval => { %>
      <tr>
        <td><%= approval.id %></td>
        <td><%= approval.booking_number %></td>
        <td><%= approval.approver.fullName %></td>
        <td><%= approval.level %></td>
        <td><%= approval.status %></td>
        <td><%= approval.approvedAt ? approval.approvedAt.toLocaleString() : '-' %></td>
      </tr>
    <% }); %>
  </tbody>
</table>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
      <a class="page-link" href="/approvals?page=<%= currentPage - 1 %>&perPage=<%= perPage %>&filter=<%= filter %>" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    <% for (let i = 1; i <= totalPages; i++) { %>
      <li class="page-item <%= i === currentPage ? 'active' : '' %>">
        <a class="page-link" href="/approvals?page<%= i %>&perPage=<%= perPage %>&filter=<%= filter %>"><%= i %></a>
      </li>
    <% } %>
    <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
      <a class="page-link" href="/approvals?page=<%= currentPage + 1 %>&perPage=<%= perPage %>&filter=<%= filter %>" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>